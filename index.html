<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Home</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="book.css">

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="index.html" class="active">Home</a></li><li class="chapter-item affix "><li class="part-title">src</li><li class="chapter-item "><a href="src/concrete/index.html">❱ concrete</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="src/concrete/Extrospection.sol/contract.Extrospection.html">Extrospection</a></li></ol></li><li class="chapter-item "><a href="src/interface/index.html">❱ interface</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="src/interface/deprecated/index.html">❱ deprecated</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="src/interface/deprecated/IExtrospectBytecodeV1.sol/interface.IExtrospectBytecodeV1.html">IExtrospectBytecodeV1</a></li></ol></li><li class="chapter-item "><a href="src/interface/IExtrospectBytecodeV2.sol/interface.IExtrospectBytecodeV2.html">IExtrospectBytecodeV2</a></li><li class="chapter-item "><a href="src/interface/IExtrospectERC1167ProxyV1.sol/interface.IExtrospectERC1167ProxyV1.html">IExtrospectERC1167ProxyV1</a></li><li class="chapter-item "><a href="src/interface/IExtrospectInterpreterV1.sol/interface.IExtrospectInterpreterV1.html">IExtrospectInterpreterV1</a></li><li class="chapter-item "><a href="src/interface/IExtrospectInterpreterV1.sol/constants.IExtrospectInterpreterV1.html">IExtrospectInterpreterV1 constants</a></li></ol></li><li class="chapter-item "><a href="src/lib/index.html">❱ lib</a><a class="toggle"><div>❱</div></a></li><li><ol class="section"><li class="chapter-item "><a href="src/lib/EVMOpcodes.sol/constants.EVMOpcodes.html">EVMOpcodes constants</a></li><li class="chapter-item "><a href="src/lib/LibExtrospectBytecode.sol/library.LibExtrospectBytecode.html">LibExtrospectBytecode</a></li><li class="chapter-item "><a href="src/lib/LibExtrospectERC1167Proxy.sol/library.LibExtrospectERC1167Proxy.html">LibExtrospectERC1167Proxy</a></li><li class="chapter-item "><a href="src/lib/LibExtrospectERC1167Proxy.sol/constants.LibExtrospectERC1167Proxy.html">LibExtrospectERC1167Proxy constants</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/rainprotocol/rain.extrospection" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="rainextrospection"><a class="header" href="#rainextrospection">rain.extrospection</a></h1>
<p>Docs at https://rainprotocol.github.io/rain.extrospection</p>
<h2 id="extrospection"><a class="header" href="#extrospection">Extrospection</a></h2>
<p>Extrospection is a collection of interfaces, libraries and an implementation
contract that expose onchain logic to offchain tooling.</p>
<p>Focus is on analysing the bytecode of contracts directly, such as deciding
whether we can prove that an address is immutable due to the absence of all state
changing opcodes.</p>
<p>Efforts have been made to implement the logic efficiently but it is expected that
the primary execution environment will be offchain, so there are somewhat gas
intensive algorithms in this repository.</p>
<h3 id="iextrospectbytecodev2"><a class="header" href="#iextrospectbytecodev2"><code>IExtrospectBytecodeV2</code></a></h3>
<p>Tools to read and get a basic understanding of what opcodes are used in the
bytecode of some address.</p>
<p>The most basic functions <code>bytecode</code> and <code>bytecodeHash</code> simply expose the
underlying native evm logic for each.</p>
<p>The more sophisticated <code>scanEVMOpcodesPresentInAccount</code> and
<code>scanEVMOpcodesReachableInAccount</code> build a bitmap of all the opcodes that are
present in the scanned contract. This bitmap is built as <code>1 &lt;&lt; opcode</code> where
opcode is a single byte, and the scan is a <code>uint256</code> so the space of all opcodes
as a <code>uint8</code> maps perfectly to all the bits in an EVM word.</p>
<p>The &quot;present in&quot; scan simply loops over the entire bytecode, but is <code>PUSH*</code> aware
so knows that the inline argument to any <code>PUSH</code> opcode is not itself an opcode.
This is the most conservative scan but can easily trigger false positives, such
as due to bytes in the CBOR metadata commonly appended to contracts by solidity.</p>
<p>CBOR metadata MAY be disabled in newer versions of Solidity and is not present
in other EVM language compilers.</p>
<p>The &quot;reachable in&quot; scan understands enough about the EVM execution environment to
ignore data that is not reachable by a <code>JUMPDEST</code>. This is achieved by pausing
the scanner after any opcode that halts execution, then resuming it once a jump
destination is found. This scan DOES NOT cause false positives due to metdata or
similar &quot;data only&quot; regions of a contract, however it is susceptible to breakages
if the EVM execution model ever changes. For example, if the set of halting ops
ever changes, or a new <code>JUMPDEST</code> alternative is invented, the scanner will
require an entirely new implementation and redeployment to support this.</p>
<h3 id="iextrospecterc1167proxyv1"><a class="header" href="#iextrospecterc1167proxyv1"><code>IExtrospectERC1167ProxyV1</code></a></h3>
<p>Check if a given account is an <code>ERC1167</code> minimal proxy contract.</p>
<p>https://eips.ethereum.org/EIPS/eip-1167</p>
<p>The minimal proxy contract has exact bytecode so we can easily check if any
account is a proxy and extract the implementation address that is being proxied.</p>
<p>Having a canonical onchain check for this simplifies downstream tooling and
minimises the surface area for implementation bugs.</p>
<h3 id="iextrospectinterpreterv1"><a class="header" href="#iextrospectinterpreterv1"><code>IExtrospectInterpreterV1</code></a></h3>
<p>Check if a candidate interpreter contract is fundamentally UNSAFE due to
mutation.</p>
<p>One fundamental hard requirement of an interpreter is that it is NOT mutable.
Most obviously this includes <code>SELFDESTRUCT</code> as that would allow for things like
metamorphic languages, which would completely undermine the integrity of any
expression that runs on the interpreter.</p>
<p>Less obviously, every opcode that would fail a standard static call is also
disallowed within interpreters. This gives interpreters a guaranteed familiar
set of security guarantees without needing to consider their internal
implementation.</p>
<p>Pragmatically this is a thin wrapper around the bytecode scanning tools that
check for reachability of dangerous opcodes in the underlying.</p>
<p>This interface and/or concrete implementations are subject to change if/when new
opcodes are supported by the EVM due to future hard forks.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->

                            <a rel="next" href="src/concrete/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

                    <a rel="next" href="src/concrete/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="solidity.min.js"></script>


    </div>
    </body>
</html>
